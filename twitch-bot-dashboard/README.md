# Twitch Bot Dashboard

## Визуализация метрик (Chart.js)
Для отображения графиков метрик в dashboard используется Chart.js. Подключите библиотеку через CDN, добавив перед `<script src="app.js"></script>` в `index.html`:

```html
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
```

Лёгкая статическая панель для управления ботом через WebSocket.

Как использовать

- Откройте `twitch-bot-dashboard/index.html` в браузере.
- Введите адрес WebSocket сервера (например `ws://localhost:8080`) и нажмите "Подключиться".
- После подключения можно отправлять сообщения или команды (json-пакеты вида `{type: 'say', text: '...'} `).

Токен аутентификации

- В поле `Токен` можно указать секретный токен. После установления WebSocket-подключения панель автоматически отправит сообщение `{type: 'auth', token: '<your-token>'}`. Сервер бота должен обрабатывать это сообщение и верифицировать токен.

Пример сервера

- В `twitch-bot` репозитории можно добавить простой WebSocket сервер, который принимает `{type, text}` и `{type:'auth', token}` сообщения. См. пример `example-server.js` (не входит в этот пакет) для быстрого теста.

Локальный пример сервера

1. В корне репозитория есть `example-server.js` — демонстрационный WebSocket сервер на Node.js.
1. Убедитесь, что у вас установлен Node.js, затем запустите:

```bash
node example-server.js
```

1. В панели введите `ws://localhost:3000` и в поле `Токен` введите `secret-token`, затем нажмите `Подключиться`.

Интегрированный сервер и быстрый запуск

- Для удобства в репозитории добавлен `server.js`, который отдаёт статические файлы панели и запускает WebSocket на одном порту (по умолчанию `http://localhost:3000`).
- Установите зависимости и запустите:

```powershell
npm install
npm run dev
```

- Откройте `http://localhost:3000` в браузере, введите токен `secret-token` и нажмите подключиться.

API команд

Панель теперь сохраняет пользовательские команды на сервере через REST API:

- GET `/api/commands?token=<token>` — получить все команды (требует `x-auth-token` или `token` query).
- POST `/api/commands` — добавить команду JSON `{name, payload}` (требует заголовок `x-auth-token`).
- DELETE `/api/commands/:name` — удалить команду (требует заголовок `x-auth-token`).

Токен по умолчанию для тестирования: `secret-token`. Перед деплоем замените на секрет в `EXAMPLE_TOKEN`.

Примечание: `example-server.js` — упрощённый пример только для локального тестирования.

Хранение команд

Команды теперь хранятся в SQLite базе `data/app.db`. При первом запуске старый `data/commands.json` будет автоматически мигрирован и переименован в `commands.json.migrated`.

Особенности

- Авто-переподключение
- Сохранение логов в localStorage
- Скачать логи в файл

Интеграция с ботом

Серверная часть должна принимать WebSocket-сообщения в JSON формате и обрабатывать поля `type` и `text`.
